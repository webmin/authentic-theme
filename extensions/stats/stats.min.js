'use strict';var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var stats={general:{timeout:1000,stopped:1,killed:0,error:0,requery:0,call:{},extend:{prefix:v___location_prefix,error:connection_error,prevent:theme_updating,language:theme_language,convert:{size:Convert.nice_size},chart:Chartist,moment:moment,locale:{time:config_portable_theme_locale_format_time,offset:function offset(){return get_utc_offset();}},state:function state(){return theme.visibility.get();},stored_length:function stored_length(){return settings_sysinfo_real_time_stored_length;},enabled:function enabled(){return settings_sysinfo_real_time_status;}},selector:{chart:{container:{parent:'live_stats',data:'data-chart'},loader:'data-charts-loader'},collapse:'collapse',dashboard:'system-status',slider:'info-container',piechart:'piechart'},query:function query(){var _this=this;this.stopped&&!this.killed&&function(){_this.stopped=0;_this.call={};if(_this.extend.prevent()){return;}var extra=String();if(document.querySelector('['+_this.selector.chart.loader+']')){extra='&sdata=1';}_this.call=$.ajax({context:_this,url:_this.extend.prefix+'/stats.cgi?xhr-stats=general'+extra,error:function error(xhr){var _this2=this;this.error++;if(this.error>3){this.extend.error(xhr,1),this.stopped=1,this.error=0,this.requery=0;return;}!this.requery&&(this.requery=setTimeout(function(){_this2.stopped=1,_this2.requery=0,_this2.query();},this.timeout*3));},success:function success(data){var _this3=this;this.error=0;setTimeout(function(){_this3.render(data);},this.timeout);this.stopped=1;},dataType:"json"});}();},render:function render(data){var _this4=this;Object.entries(data).map(function(_ref){var _ref2=_slicedToArray(_ref,2),target=_ref2[0],data=_ref2[1];var v=parseInt(data),vo=(typeof data==='undefined'?'undefined':_typeof(data))==='object'?data[data.length-1]:false,vt=vo?vo:v,$pc=$('#'+_this4.selector.dashboard+' .'+_this4.selector.piechart+'[data-charts*="'+target+'"]'),$lc=$('.'+_this4.selector.slider+' .'+target+'_percent'),$od=$('#'+_this4.selector.dashboard+' span[data-id="sysinfo_'+target+'"], \n                             .'+_this4.selector.slider+' span[data-data="'+target+'"]'),cached=target==='fcached'?2:target==='scached'?1:0;if(Number.isInteger(v)){if($pc.length){$pc.data('easyPieChart').update(v);}if($lc.length){$lc.find('.bar').attr('style','width:'+v+'%');var $dp=$lc.find('.description'),$lb=$dp.text().split(":")[0];$dp.attr('title',vo).text($lb+": "+v+'% ('+vo+')');}if($od.length){if($od.find('a').length){$od.find('a').text(vt);}else{$od.text(vt);}}}if(cached){var lds=_this4.selector.chart.container.parent+'-'+_this4.selector.collapse,ld=$('#'+lds).find('['+_this4.selector.chart.loader+']');Object.entries(data).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),_type=_ref4[0],array=_ref4[1];var options={chart:{type:function type(){return _type==='proc'||_type==='disk'||_type==='net';},bandwidth:function bandwidth(){return _type==='disk'||_type==='net';},fill:function fill(){return this.type()?false:true;},high:function high(){return this.type()?undefined:100;},threshold:function threshold(){return this.type()?-1:50;},height:'100px'}},lg=_this4.extend.language(_this4.selector.chart.container.parent+'_'+_type),tg=$('#'+lds).find('['+_this4.selector.chart.container.data+'='+_type+']'),sr=[{name:'series-'+_type,data:array}];if(!tg.length){return;}if(array[0]&&_typeof(array[0].y)==='object'){sr=[];array[0].y.forEach(function(x,i){var data=[];array.forEach(function(n){data.push({data:{x:n.x,y:n.y[i]}});});sr.push({name:'series-'+_type+'-'+i,data:data});});}if(tg[0]&&tg[0].textContent){if(cached===1){var lf=parseInt(_this4.extend.stored_length());if(lf<600||lf>86400){lf=600;}var tdata=sr,cdata=_this4['chart_'+_type].data.series,cdata_start=void 0,cdata_end=void 0,cdata_ready=new Promise(function(resolve){tdata.forEach(function(d,i,a){cdata_start=cdata[i].data[0].x||cdata[i].data[0].data.x;cdata_end=cdata[i].data[cdata[i].data.length-1].x||cdata[i].data[cdata[i].data.length-1].data.x;cdata[i].data.push(d.data[0]);if(cdata_end-cdata_start>lf){cdata[i].data.shift();}if(i===a.length-1){resolve();}});});cdata_ready.then(function(){_this4['chart_'+_type].update({series:cdata});});}}else if(cached===2){_this4['chart_'+_type]=new _this4.extend.chart.Line(tg[0],{series:sr},{axisX:{type:_this4.extend.chart.FixedScaleAxis,divisor:12,labelInterpolationFnc:function labelInterpolationFnc(value){return _this4.extend.moment(value*1000).utcOffset(_this4.extend.locale.offset()).format(_this4.extend.locale.time);}},height:options.chart.height,showArea:options.chart.fill(),showPoint:!options.chart.fill(),high:options.chart.high(),low:0,fullWidth:true,chartPadding:{left:25},axisY:{onlyInteger:true,labelInterpolationFnc:function labelInterpolationFnc(value){if(options.chart.fill()){return value?value+'%':value;}else if(options.chart.bandwidth(value)){if(_type==='net'){return value?_this4.extend.convert.size(value,{'fixed':0,'bits':1,'round':1}):value;}return value?_this4.extend.convert.size(value*1000,{'fixed':0,'round':1}):value;}else{return value;}}},plugins:[_this4.extend.chart.plugins.ctAxisTitle({axisY:{axisTitle:lg,axisClass:"ct-axis-title",offset:{x:0,y:9},flipTitle:true}}),_this4.extend.chart.plugins.ctThreshold({threshold:options.chart.threshold()})]});_this4['chart_'+_type].on('created',function(){return ld.remove();});}});}});setTimeout(function(){_this4.extend.state()&&_this4.query();},200);},disable:function disable(){var _this5=this;var abort=this.call.abort;typeof abort==="function"&&(abort.call(),this.stopped=0);this.killed=1;setTimeout(function(){_this5.stopped=1,_this5.call={};},this.timeout+2);},enable:function enable(){if(this.extend.enabled()){this.stopped=1,this.killed=0,this.query();}}}};
