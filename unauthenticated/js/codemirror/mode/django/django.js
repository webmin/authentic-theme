(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("django:inner",function(){var g=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],b=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],e=["==","!=","<",">","<=",">="],h=["in","not","or","and"];g=new RegExp("^\\b("+g.join("|")+")\\b");b=new RegExp("^\\b("+b.join("|")+")\\b");e=new RegExp("^\\b("+e.join("|")+")\\b");h=new RegExp("^\\b("+h.join("|")+")\\b");function d(m,l){if(m.match("{{")){l.tokenize=i;return"tag"}else{if(m.match("{%")){l.tokenize=c;return"tag"}else{if(m.match("{#")){l.tokenize=j;return"comment"}}}while(m.next()!=null&&!m.match(/\{[{%#]/,false)){}return null}function f(m,l){return function(p,o){if(!o.escapeNext&&p.eat(m)){o.tokenize=l}else{if(o.escapeNext){o.escapeNext=false}var n=p.next();if(n=="\\"){o.escapeNext=true}}return"string"}}function i(m,l){if(l.waitDot){l.waitDot=false;if(m.peek()!="."){return"null"}if(m.match(/\.\W+/)){return"error"}else{if(m.eat(".")){l.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(l.waitPipe){l.waitPipe=false;if(m.peek()!="|"){return"null"}if(m.match(/\.\W+/)){return"error"}else{if(m.eat("|")){l.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(l.waitProperty){l.waitProperty=false;if(m.match(/\b(\w+)\b/)){l.waitDot=true;l.waitPipe=true;return"property"}}if(l.waitFilter){l.waitFilter=false;if(m.match(b)){return"variable-2"}}if(m.eatSpace()){l.waitProperty=false;return"null"}if(m.match(/\b\d+(\.\d+)?\b/)){return"number"}if(m.match("'")){l.tokenize=f("'",l.tokenize);return"string"}else{if(m.match('"')){l.tokenize=f('"',l.tokenize);return"string"}}if(m.match(/\b(\w+)\b/)&&!l.foundVariable){l.waitDot=true;l.waitPipe=true;return"variable"}if(m.match("}}")){l.waitProperty=null;l.waitFilter=null;l.waitDot=null;l.waitPipe=null;l.tokenize=d;return"tag"}m.next();return"null"}function c(n,m){if(m.waitDot){m.waitDot=false;if(n.peek()!="."){return"null"}if(n.match(/\.\W+/)){return"error"}else{if(n.eat(".")){m.waitProperty=true;return"null"}else{throw Error("Unexpected error while waiting for property.")}}}if(m.waitPipe){m.waitPipe=false;if(n.peek()!="|"){return"null"}if(n.match(/\.\W+/)){return"error"}else{if(n.eat("|")){m.waitFilter=true;return"null"}else{throw Error("Unexpected error while waiting for filter.")}}}if(m.waitProperty){m.waitProperty=false;if(n.match(/\b(\w+)\b/)){m.waitDot=true;m.waitPipe=true;return"property"}}if(m.waitFilter){m.waitFilter=false;if(n.match(b)){return"variable-2"}}if(n.eatSpace()){m.waitProperty=false;return"null"}if(n.match(/\b\d+(\.\d+)?\b/)){return"number"}if(n.match("'")){m.tokenize=f("'",m.tokenize);return"string"}else{if(n.match('"')){m.tokenize=f('"',m.tokenize);return"string"}}if(n.match(e)){return"operator"}if(n.match(h)){return"keyword"}var l=n.match(g);if(l){if(l[0]=="comment"){m.blockCommentTag=true}return"keyword"}if(n.match(/\b(\w+)\b/)){m.waitDot=true;m.waitPipe=true;return"variable"}if(n.match("%}")){m.waitProperty=null;m.waitFilter=null;m.waitDot=null;m.waitPipe=null;if(m.blockCommentTag){m.blockCommentTag=false;m.tokenize=k}else{m.tokenize=d}return"tag"}n.next();return"null"}function j(m,l){if(m.match(/^.*?#\}/)){l.tokenize=d}else{m.skipToEnd()}return"comment"}function k(m,l){if(m.match(/\{%\s*endcomment\s*%\}/,false)){l.tokenize=c;m.match("{%");return"tag"}else{m.next();return"comment"}}return{startState:function(){return{tokenize:d}},token:function(m,l){return l.tokenize(m,l)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}});a.defineMode("django",function(b){var d=a.getMode(b,"text/html");var c=a.getMode(b,"django:inner");return a.overlayMode(d,c)});a.defineMIME("text/x-django","django")});