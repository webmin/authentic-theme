/*! jQuery UI - v1.12.1 - 2018-03-18
* http://jqueryui.com
* Includes: widget.js, unique-id.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){e.ui=e.ui||{},e.ui.version="1.12.1";var t,i=0,n=Array.prototype.slice;e.cleanData=e.cleanData||(t=e.cleanData,function(i){var n,r,o;for(o=0;null!=(r=i[o]);o++)try{(n=e._data(r,"events"))&&n.remove&&e(r).triggerHandler("remove")}catch(e){}t(i)}),e.widget=e.widget||function(t,i,n){var r,o,s,a={},l=t.split(".")[0],d=l+"-"+(t=t.split(".")[1]);return n||(n=i,i=e.Widget),e.isArray(n)&&(n=e.extend.apply(null,[{}].concat(n))),e.expr[":"][d.toLowerCase()]=function(t){return!!e.data(t,d)},e[l]=e[l]||{},r=e[l][t],o=e[l][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),(s=new i).options=e.widget.extend({},s.options),e.each(n,function(t,n){e.isFunction(n)?a[t]=function(){function e(){return i.prototype[t].apply(this,arguments)}function r(e){return i.prototype[t].apply(this,e)}return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=o,t}}():a[t]=n}),o.prototype=e.widget.extend(s,{widgetEventPrefix:r&&s.widgetEventPrefix||t},a,{constructor:o,namespace:l,widgetName:t,widgetFullName:d}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,o,i._proto)}),delete r._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,r,o=n.call(arguments,1),s=0,a=o.length;s<a;s++)for(i in o[s])r=o[s][i],o[s].hasOwnProperty(i)&&void 0!==r&&(e.isPlainObject(r)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],r):e.widget.extend({},r):t[i]=r);return t},e.widget.bridge=function(t,i){var r=i.prototype.widgetFullName||t;e.fn[t]=function(o){var s="string"==typeof o,a=n.call(arguments,1),l=this;return s?this.length||"instance"!==o?this.each(function(){var i,n=e.data(this,r);return"instance"===o?(l=n,!1):n?e.isFunction(n[o])&&"_"!==o.charAt(0)?(i=n[o].apply(n,a))!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+o+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+o+"'")}):l=void 0:(a.length&&(o=e.widget.extend.apply(null,[o].concat(a))),this.each(function(){var t=e.data(this,r);t?(t.option(o||{}),t._init&&t._init()):e.data(this,r,new i(o,this))})),l}},e.Widget=e.Widget||function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,i){t._removeClass(i,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,r,o,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},n=t.split("."),t=n.shift(),n.length){for(r=s[t]=e.widget.extend({},this.options[t]),o=0;o<n.length-1;o++)r[n[o]]=r[n[o]]||{},r=r[n[o]];if(t=n.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,n,r;for(i in t)r=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&r&&r.length&&(n=e(r.get()),this._removeClass(r,i),n.addClass(this._classes({element:n,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function i(i,o){var s,a;for(a=0;a<i.length;a++)s=r.classesElementLookup[i[a]]||e(),s=e(t.add?e.unique(s.get().concat(t.element.get())):s.not(t.element).get()),r.classesElementLookup[i[a]]=s,n.push(i[a]),o&&t.classes[i[a]]&&n.push(t.classes[i[a]])}var n=[],r=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&i(t.keys.match(/\S+/g)||[],!0),t.extra&&i(t.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(t){var i=this;e.each(i.classesElementLookup,function(n,r){-1!==e.inArray(t.target,r)&&(i.classesElementLookup[n]=e(r.not(t.target).get()))})},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,n){n="boolean"==typeof n?n:i;var r="string"==typeof e||null===e,o={extra:r?t:i,keys:r?e:t,element:r?this.element:e,add:n};return o.element.toggleClass(this._classes(o),n),this},_on:function(t,i,n){var r,o=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,function(n,s){function a(){if(t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof s?o[s]:s).apply(o,arguments)}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),d=l[1]+o.eventNamespace,c=l[2];c?r.on(d,c,a):i.on(d,a)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(i).off(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,n){var r,o,s=this.options[t];if(n=n||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(s)&&!1===s.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){var s;"string"==typeof r&&(r={effect:r});var a=r?!0===r||"number"==typeof r?i:r.effect||i:t;"number"==typeof(r=r||{})&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&e.effects&&e.effects.effect[a]?n[t](r):a!==t&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}}),e.widget,function(){function t(e,t,i){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}var n,r=Math.max,o=Math.abs,s=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,c=/%$/,h=e.fn.position;e.position=e.position||{scrollbarWidth:function(){if(void 0!==n)return n;var t,i,r=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=r.children()[0];return e("body").append(r),t=o.offsetWidth,r.css("overflow","scroll"),t===(i=o.offsetWidth)&&(i=r[0].clientWidth),r.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),n=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:r,offset:n||r?{left:0,top:0}:e(t).offset(),scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return h.apply(this,arguments);n=e.extend({},n);var c,u,f,p,g,v,y,m,b=e(n.of),x=e.position.getWithinInfo(n.within),_=e.position.getScrollInfo(x),w=(n.collision||"flip").split(" "),k={};return v=9===(m=(y=b)[0]).nodeType?{width:y.width(),height:y.height(),offset:{top:0,left:0}}:e.isWindow(m)?{width:y.width(),height:y.height(),offset:{top:y.scrollTop(),left:y.scrollLeft()}}:m.preventDefault?{width:0,height:0,offset:{top:m.pageY,left:m.pageX}}:{width:y.outerWidth(),height:y.outerHeight(),offset:y.offset()},b[0].preventDefault&&(n.at="left top"),u=v.width,f=v.height,p=v.offset,g=e.extend({},p),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=s.test(i[0])?i.concat(["center"]):a.test(i[0])?["center"].concat(i):["center","center"]),i[0]=s.test(i[0])?i[0]:"center",i[1]=a.test(i[1])?i[1]:"center",e=l.exec(i[0]),t=l.exec(i[1]),k[this]=[e?e[0]:0,t?t[0]:0],n[this]=[d.exec(i[0])[0],d.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?g.left+=u:"center"===n.at[0]&&(g.left+=u/2),"bottom"===n.at[1]?g.top+=f:"center"===n.at[1]&&(g.top+=f/2),c=t(k.at,u,f),g.left+=c[0],g.top+=c[1],this.each(function(){var s,a,l=e(this),d=l.outerWidth(),h=l.outerHeight(),v=i(this,"marginLeft"),y=i(this,"marginTop"),m=d+v+i(this,"marginRight")+_.width,C=h+y+i(this,"marginBottom")+_.height,N=e.extend({},g),S=t(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?N.left-=d:"center"===n.my[0]&&(N.left-=d/2),"bottom"===n.my[1]?N.top-=h:"center"===n.my[1]&&(N.top-=h/2),N.left+=S[0],N.top+=S[1],s={marginLeft:v,marginTop:y},e.each(["left","top"],function(t,i){e.ui.position[w[t]]&&e.ui.position[w[t]][i](N,{targetWidth:u,targetHeight:f,elemWidth:d,elemHeight:h,collisionPosition:s,collisionWidth:m,collisionHeight:C,offset:[c[0]+S[0],c[1]+S[1]],my:n.my,at:n.at,within:x,elem:l})}),n.using&&(a=function(e){var t=p.left-N.left,i=t+u-d,s=p.top-N.top,a=s+f-h,c={target:{element:b,left:p.left,top:p.top,width:u,height:f},element:{element:l,left:N.left,top:N.top,width:d,height:h},horizontal:i<0?"left":t>0?"right":"center",vertical:a<0?"top":s>0?"bottom":"middle"};u<d&&o(t+i)<u&&(c.horizontal="center"),f<h&&o(s+a)<f&&(c.vertical="middle"),r(o(t),o(i))>r(o(s),o(a))?c.important="horizontal":c.important="vertical",n.using.call(this,e,c)}),l.offset(e.extend(N,{using:a}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,a=e.left-t.collisionPosition.marginLeft,l=o-a,d=a+t.collisionWidth-s-o;t.collisionWidth>s?l>0&&d<=0?(i=e.left+l+t.collisionWidth-s-o,e.left+=l-i):e.left=d>0&&l<=0?o:l>d?o+s-t.collisionWidth:o:l>0?e.left+=l:d>0?e.left-=d:e.left=r(e.left-a,e.left)},top:function(e,t){var i,n=t.within,o=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,a=e.top-t.collisionPosition.marginTop,l=o-a,d=a+t.collisionHeight-s-o;t.collisionHeight>s?l>0&&d<=0?(i=e.top+l+t.collisionHeight-s-o,e.top+=l-i):e.top=d>0&&l<=0?o:l>d?o+s-t.collisionHeight:o:l>0?e.top+=l:d>0?e.top-=d:e.top=r(e.top-a,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,s=r.offset.left+r.scrollLeft,a=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,d=e.left-t.collisionPosition.marginLeft,c=d-l,h=d+t.collisionWidth-a-l,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,f="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];c<0?((i=e.left+u+f+p+t.collisionWidth-a-s)<0||i<o(c))&&(e.left+=u+f+p):h>0&&((n=e.left-t.collisionPosition.marginLeft+u+f+p-l)>0||o(n)<h)&&(e.left+=u+f+p)},top:function(e,t){var i,n,r=t.within,s=r.offset.top+r.scrollTop,a=r.height,l=r.isWindow?r.scrollTop:r.offset.top,d=e.top-t.collisionPosition.marginTop,c=d-l,h=d+t.collisionHeight-a-l,u="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];c<0?((n=e.top+u+f+p+t.collisionHeight-a-s)<0||n<o(c))&&(e.top+=u+f+p):h>0&&((i=e.top-t.collisionPosition.marginTop+u+f+p-l)>0||o(i)<h)&&(e.top+=u+f+p)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}();var r;e.ui.position,e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},e.fn.scrollParent=function(t){var i=this.css("position"),n="absolute"===i,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!n||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:e(this[0].ownerDocument||document)},e.fn.extend({uniqueId:(r=0,function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})}),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}})}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(t,i){t||(i=i?": "+i:"",e.error("Fancytree assertion failed"+i))}function i(e,t){var i,n,r=window.console?window.console[e]:null;if(r)try{r.apply(window.console,t)}catch(e){for(n="",i=0;i<t.length;i++)n+=t[i];r(n)}}function n(){var t,i,r,o,s,a=arguments[0]||{},l=1,d=arguments.length;if("object"==typeof a||e.isFunction(a)||(a={}),l===d)throw Error("need at least two args");for(;l<d;l++)if(null!=(t=arguments[l]))for(i in t)if(t.hasOwnProperty(i)){if(r=a[i],a===(o=t[i]))continue;o&&e.isPlainObject(o)?(s=r&&e.isPlainObject(r)?r:{},a[i]=n(s,o)):void 0!==o&&(a[i]=o)}return a}function r(e,t,i,n,r){var o,s,a,l,d;return o=t[e],s=n[e],a=t.ext[r],l=function(){return o.apply(t,arguments)},d=function(e){return o.apply(t,e)},function(){var e=t._local,i=t._super,n=t._superApply;try{return t._local=a,t._super=l,t._superApply=d,s.apply(t,arguments)}finally{t._local=e,t._super=i,t._superApply=n}}}function o(t,i,n,o){for(var s in n)"function"==typeof n[s]?"function"==typeof t[s]?t[s]=r(s,t,0,n,o):"_"===s.charAt(0)?t.ext[o][s]=r(s,t,0,n,o):e.error("Could not override tree."+s+". Use prefix '_' to create tree."+o+"._"+s):"options"!==s&&(t.ext[o][s]=n[s])}function s(t,i){return void 0===t?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,i)}).promise()}function a(t,i){return void 0===t?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,i)}).promise()}function l(e,t){return function(){e.resolveWith(t)}}function d(t){var i=e.extend({},t.data()),n=i.json;return delete i.fancytree,delete i.uiFancytree,n&&(delete i.json,i=e.extend(i,n)),i}function c(e){return(""+e).replace(m,function(e){return x[e]})}function h(e){return e=e.toLowerCase(),function(t){return 0<=t.title.toLowerCase().indexOf(e)}}function u(i,n){var r,o,s,a;for(this.parent=i,this.tree=i.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},r=0,o=T.length;r<o;r++)this[s=T[r]]=n[s];for(s in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),n.hideCheckbox&&e.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),n.data&&e.extend(this.data,n.data),n)F[s]||e.isFunction(n[s])||A[s]||(this.data[s]=n[s]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),t(this.key,"defaultKey() must return a unique key")):this.key="_"+v._nextNodeKey++:this.key=""+this.key,n.active&&(t(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),n.selected&&(this.tree.lastSelectedNode=this),(a=n.children)?a.length?this._setChildren(a):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function f(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&(void 0!==this.options.lazyload&&e.error("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),void 0!==this.options.loaderror&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&e.error("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&e.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=d(this.$div),this._id=""+(this.options.treeId||e.ui.fancytree._nextId++),this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.viewport=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var i,n={tree:this};this.rootNode=new u(n,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,i=e("<ul>",{id:"ft-id-"+this._id,class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=i,this.rootNode.ul=i[0],null==this.options.debugLevel&&(this.options.debugLevel=v.debugLevel)}if(!e.ui||!e.ui.fancytree){var p,g,v=null,y=new RegExp(/\.|\//),m=/[<>"'\/]/g,b="$recursive_request",x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},_={16:!0,17:!0,18:!0},w={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},k={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},C={0:"",1:"left",2:"middle",3:"right"},N="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),S={},E="columns types".split(" "),T="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),F={},H={},A={active:!0,children:!0,data:!0,focus:!0};for(p=0;p<N.length;p++)S[N[p]]=!0;for(p=0;p<T.length;p++)g=T[p],F[g]=!0,g!==g.toLowerCase()&&(H[g.toLowerCase()]=g);return t(e.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),u.prototype={_findDirectChild:function(e){var t,i,n=this.children;if(n)if("string"==typeof e){for(t=0,i=n.length;t<i;t++)if(n[t].key===e)return n[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){t(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var i=0,n=e.length;i<n;i++)this.children.push(new u(this,e[i]));this.tree._callHook("treeStructureChanged",this.tree,"setChildren")},addChildren:function(i,n){var r,o,s,a,l=this.getFirstChild(),d=this.getLastChild(),c=[];for(e.isPlainObject(i)&&(i=[i]),this.children||(this.children=[]),r=0,o=i.length;r<o;r++)c.push(new u(this,i[r]));if(a=c[0],null==n?this.children=this.children.concat(c):(n=this._findDirectChild(n),t(0<=(s=e.inArray(n,this.children)),"insertBefore must be an existing child"),this.children.splice.apply(this.children,[s,0].concat(c))),l&&!n){for(r=0,o=c.length;r<o;r++)c[r].render();l!==this.getFirstChild()&&l.renderStatus(),d!==this.getLastChild()&&d.renderStatus()}else(!this.parent||this.parent.ul||this.tr)&&this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===c.length?c[0]:null),a},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,i){switch(void 0!==i&&"over"!==i||(i="child"),i){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}t(!1,"Invalid mode: "+i)},addPagingNode:function(t,i){var n,r;if(i=i||"child",!1!==t)return t=e.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,i);for(n=this.children.length-1;0<=n;n--)"paging"===(r=this.children[n]).statusNodeType&&this.removeChild(r);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(t){if(null===t)return this.remove(),s(this);var i,n,r={children:!0,expanded:!0,parent:!0};for(i in t)t.hasOwnProperty(i)&&(n=t[i],r[i]||e.isFunction(n)||(F[i]?this[i]=n:this.data[i]=n));return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):s(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,i){return e.addNode(this.toDict(!0,i),t)},countChildren:function(e){var t,i,n,r=this.children;if(!r)return 0;if(n=r.length,!1!==e)for(t=0,i=n;t<i;t++)n+=r[t].countChildren();return n},debug:function(e){4<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},error:function(e){1<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("error",arguments))},findAll:function(t){t=e.isFunction(t)?t:h(t);var i=[];return this.visit(function(e){t(e)&&i.push(e)}),i},findFirst:function(t){t=e.isFunction(t)?t:h(t);var i=null;return this.visit(function(e){if(t(e))return i=e,!1}),i},findRelatedNode:function(e,t){return this.tree.findRelatedNode(this,e,t)},_changeSelectStatusAttrs:function(e){var i=!1,n=this.tree.options,r=v.evalOption("unselectable",this,this,n,!1),o=v.evalOption("unselectableStatus",this,this,n,void 0);switch(r&&null!=o&&(e=o),e){case!1:i=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:i=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:i=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:t(!1,"invalid state: "+e)}return i&&this.renderStatus(),i},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){if(e._changeSelectStatusAttrs(t),e.radiogroup)return"skip"}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){var i=this.tree.options;t(3===i.selectMode,"expected selectMode 3"),function e(t){var n,r,o,s,a,l,d,c,h=t.children;if(h&&h.length){for(d=!(l=!0),n=0,r=h.length;n<r;n++)s=e(o=h[n]),v.evalOption("unselectableIgnore",o,o,i,!1)||(!1!==s&&(d=!0),!0!==s&&(l=!1));a=!!l||!!d&&void 0}else a=null==(c=v.evalOption("unselectableStatus",t,t,i,void 0))?!!t.selected:!!c;t.partsel&&!t.selected&&t.lazy&&null==t.children&&(a=void 0),t._changeSelectStatusAttrs(a),a}(this),this.visitParents(function(e){var t,n,r,o,s,a=e.children,l=!0,d=!1;for(t=0,n=a.length;t<n;t++)r=a[t],v.evalOption("unselectableIgnore",r,r,i,!1)||(((o=null==(s=v.evalOption("unselectableStatus",r,r,i,void 0))?!!r.selected:!!s)||r.partsel)&&(d=!0),o||(l=!1));o=!!l||!!d&&void 0,e._changeSelectStatusAttrs(o)})},fromDict:function(t){for(var i in t)F[i]?this[i]=t[i]:"data"===i?e.extend(this.data,t.data):e.isFunction(t[i])||A[i]||(this.data[i]=t[i]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t,i){t=t||".";var n,r=[];return e.each(this.getParentList(!1,!0),function(e,t){n=""+(t.getIndex()+1),i&&(n=("0000000"+n).substr(-i)),r.push(n)}),r.join(t)},getKeyPath:function(e){var t=this.tree.options.keyPathSeparator;return t+this.getPath(!e,"key",t)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,i=this.parent.children;for(e=0,t=i.length-1;e<t;e++)if(i[e]===this)return i[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var i=[],n=t?this:this.parent;n;)(e||n.parent)&&i.unshift(n),n=n.parent;return i},getPath:function(t,i,n){t=!1!==t,i=i||"title",n=n||"/";var r,o=[],s=e.isFunction(i);return this.visitParents(function(e){e.parent&&(r=s?i(e):e[i],o.unshift(r))},t),o.join(n)},getPrevSibling:function(){if(this.parent){var e,t,i=this.parent.children;for(e=1,t=i.length;e<t;e++)if(i[e]===this)return i[e-1]}return null},getSelectedNodes:function(e){var t=[];return this.visit(function(i){if(i.selected&&(t.push(i),!0===e))return"skip"}),t},hasChildren:function(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){3<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(t){if(!t||t.tree!==this.tree)return!1;for(var i=this.parent;i;){if(i===t)return!0;i===i.parent&&e.error("Recursive parent link: "+i),i=i.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,i=this.tree.enableFilter,n=this.getParentList(!1,!1);if(i&&!this.match&&!this.subMatchCount)return this.debug("isVisible: HIDDEN ("+i+", "+this.match+", "+this.match+")"),!1;for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return this.debug("isVisible: HIDDEN (parent collapsed)"),!1;return this.debug("isVisible: VISIBLE"),!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var i,n,r=this,o=this.isExpanded();return t(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(n=this.tree._triggerNodeEvent("lazyLoad",this))?s(this):(t("boolean"!=typeof n,"lazyLoad event must return source in data.result"),i=this.tree._callHook("nodeLoadChildren",this,n),o?(this.expanded=!0,i.always(function(){r.render()})):i.always(function(){r.renderStatus()}),i)):s(this)},makeVisible:function(t){var i,n=this,r=[],o=new e.Deferred,s=this.getParentList(!1,!1),a=s.length,l=!(t&&!0===t.noAnimation),d=!(t&&!1===t.scrollIntoView);for(i=a-1;0<=i;i--)r.push(s[i].setExpanded(!0,t));return e.when.apply(e,r).done(function(){d?n.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(i,n,r){void 0===n||"over"===n?n="child":"firstChild"===n&&(i.children&&i.children.length?(n="before",i=i.children[0]):n="child");var o,s=this.tree,a=this.parent,l="child"===n?i:i.parent;if(this!==i){if(this.parent?l.isDescendantOf(this)&&e.error("Cannot move a node to its own descendant"):e.error("Cannot move system root"),l!==a&&a.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===l)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else t(0<=(o=e.inArray(this,this.parent.children)),"invalid source parent"),this.parent.children.splice(o,1);if((this.parent=l).hasChildren())switch(n){case"child":l.children.push(this);break;case"before":t(0<=(o=e.inArray(i,l.children)),"invalid target parent"),l.children.splice(o,0,this);break;case"after":t(0<=(o=e.inArray(i,l.children)),"invalid target parent"),l.children.splice(o+1,0,this);break;default:e.error("Invalid mode "+n)}else l.children=[this];r&&i.visit(r,!0),l===a?l.triggerModifyChild("move",this):l.triggerModifyChild("add",this),s!==i.tree&&(this.warn("Cross-tree moveTo is experimental!"),this.visit(function(e){e.tree=i.tree},!0)),s._callHook("treeStructureChanged",s,"moveTo"),a.isDescendantOf(l)||a.render(),l.isDescendantOf(a)||l===a||l.render()}},navigate:function(t,i){var n,r=e.ui.keyCode;switch(t){case"left":case r.LEFT:if(this.expanded)return this.setExpanded(!1);break;case"right":case r.RIGHT:if(!this.expanded&&(this.children||this.lazy))return this.setExpanded()}if(n=this.findRelatedNode(t)){try{n.makeVisible({scrollIntoView:!1})}catch(e){}return!1===i?n.setFocus():n.setActive()}return this.warn("Could not find related node '"+t+"'."),s()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){
return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(i){var n,r=this.parent,o=e.inArray(this,r.children),s=this;return t(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(n=this.tree._callHook("nodeLoadChildren",this,i)).done(function(e){var t=s.children;for(p=0;p<t.length;p++)t[p].parent=r;r.children.splice.apply(r.children,[o+1,0].concat(t)),s.children=null,s.remove(),r.render()}).fail(function(){s.setExpanded()}),n},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(t,i){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var n=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},i);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},i);break;default:e.error("Invalid mode "+t)}},scrollIntoView:function(i,n){if(void 0!==n&&(r=n).tree&&void 0!==r.statusNodeType)throw Error("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.");var r,o=e.extend({effects:!0===i?{duration:200,queue:!1}:i,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},n),a=o.scrollParent,l=this.tree.$container,d=l.css("overflow-y");a?a.jquery||(a=e(a)):a=this.tree.tbody?l.scrollParent():"scroll"===d||"auto"===d?l:l.scrollParent(),a[0]!==document&&a[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",a[0]),a=e(window));var c,h,u,f=new e.Deferred,p=this,g=e(this.span).height(),v=o.scrollOfs.top||0,y=o.scrollOfs.bottom||0,m=a.height(),b=a.scrollTop(),x=a,_=a[0]===window,w=o.topNode||null,k=null;return this.isVisible()?(_?(h=e(this.span).offset().top,c=w&&w.span?e(w.span).offset().top:0,x=e("html,body")):(t(a[0]!==document&&a[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),u=a.offset().top,h=e(this.span).offset().top-u+b,c=w?e(w.span).offset().top-u+b:0,m-=Math.max(0,a.innerHeight()-a[0].clientHeight)),h<b+v?k=h-v:b+m-y<h+g&&(k=h+g-m+y,w&&(t(w.isRootNode()||w.isVisible(),"topNode must be visible"),c<k&&(k=c-v))),null===k?f.resolveWith(this):o.effects?(o.effects.complete=function(){f.resolveWith(p)},x.stop(!0).animate({scrollTop:k},o.effects)):(x[0].scrollTop=k,f.resolveWith(this)),f.promise()):(this.warn("scrollIntoView(): node is invisible."),s())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,i){return this.tree._callHook("nodeSetStatus",this,e,t,i)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var i,n,r=this.children;if(r){if(e=e||function(e,t){var i=e.title.toLowerCase(),n=t.title.toLowerCase();return i===n?0:n<i?1:-1},r.sort(e),t)for(i=0,n=r.length;i<n;i++)r[i].children&&r[i].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(t,i){var n,r,o,s={},a=this;if(e.each(T,function(e,t){(a[t]||!1===a[t])&&(s[t]=a[t])}),e.isEmptyObject(this.data)||(s.data=e.extend({},this.data),e.isEmptyObject(s.data)&&delete s.data),i&&i(s,a),t&&this.hasChildren())for(s.children=[],n=0,r=this.children.length;n<r;n++)(o=this.children[n]).isStatusNode()||s.children.push(o.toDict(!0,i));return s},toggleClass:function(t,i){var n,r,o=t.match(/\S+/g)||[],s=0,a=!1,l=this[this.tree.statusClassPropName],d=" "+(this.extraClasses||"")+" ";for(l&&e(l).toggleClass(t,i);n=o[s++];)if(r=0<=d.indexOf(" "+n+" "),i=void 0===i?!r:!!i)r||(d+=n+" ",a=!0);else for(;-1<d.indexOf(" "+n+" ");)d=d.replace(" "+n+" "," ");return this.extraClasses=e.trim(d),a},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(t,i,n){var r,o=this.tree.options.modifyChild;o&&(i&&i.parent!==this&&e.error("childNode "+i+" is not a child of "+this),r={node:this,tree:this.tree,operation:t,childNode:i||null},n&&e.extend(r,n),o({type:"modifyChild"},r))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var i,n,r=!0,o=this.children;if(!0===t&&(!1===(r=e(this))||"skip"===r))return r;if(o)for(i=0,n=o.length;i<n&&!1!==(r=o[i].visit(e,!0));i++);return r},visitAndLoad:function(t,i,n){var r,o,a,l=this;return!t||!0!==i||!1!==(o=t(l))&&"skip"!==o?l.children||l.lazy?(r=new e.Deferred,a=[],l.load().done(function(){for(var i=0,n=l.children.length;i<n;i++){if(!1===(o=l.children[i].visitAndLoad(t,!0,!0))){r.reject();break}"skip"!==o&&a.push(o)}e.when.apply(this,a).then(function(){r.resolve()})}),r.promise()):s():n?o:s()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var i=this.parent;i;){if(!1===e(i))return!1;i=i.parent}return!0},visitSiblings:function(e,t){var i,n,r,o=this.parent.children;for(i=0,n=o.length;i<n;i++)if(r=o[i],(t||r!==this)&&!1===e(r))return!1;return!0},warn:function(e){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("warn",arguments))}},f.prototype={_makeHookContext:function(t,i,n){var r,o;return void 0!==t.node?(i&&t.originalEvent!==i&&e.error("invalid args"),r=t):t.tree?r={node:t,tree:o=t.tree,widget:o.widget,options:o.widget.options,originalEvent:i,typeInfo:o.types[t.type]||{}}:t.widget?r={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:i}:e.error("invalid args"),n&&e.extend(r,n),r},_callHook:function(t,i,n){var r=this._makeHookContext(i),o=this[t],s=Array.prototype.slice.call(arguments,2);return e.isFunction(o)||e.error("_callHook('"+t+"') is not a function"),s.unshift(r),o.apply(this,s)},_setExpiringValue:function(e,t,i){this._tempCache[e]={value:t,expire:Date.now()+(+i||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_requireExtension:function(i,n,r,o){null!=r&&(r=!!r);var s=this._local.name,a=this.options.extensions,l=e.inArray(i,a)<e.inArray(s,a),d=n&&null==this.ext[i],c=!d&&null!=r&&r!==l;return t(s&&s!==i,"invalid or same name '"+s+"' (require yourself?)"),!d&&!c||(o||(d||n?(o="'"+s+"' extension requires '"+i+"'",c&&(o+=" to be registered "+(r?"before":"after")+" itself")):o="If used together, `"+i+"` must be registered "+(r?"before":"after")+" `"+s+"`"),e.error(o),!1)},activateKey:function(e,t){var i=this.getNodeByKey(e);return i?i.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),i},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyPatch:function(i){var n,r,o,s,a,d,c=i.length,h=[];for(r=0;r<c;r++)t(2===(o=i[r]).length,"patchList must be an array of length-2-arrays"),s=o[0],a=o[1],(d=null===s?this.rootNode:this.getNodeByKey(s))?(n=new e.Deferred,h.push(n),d.applyPatch(a).always(l(n,d))):this.warn("could not find node with key '"+s+"'");return e.when.apply(e,h).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){4<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("log",arguments))},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return e=!1!==e,!!this._enableUpdate==!!e?e:((this._enableUpdate=e)?(this.debug("enableUpdate(true): redraw "),this._callHook("treeStructureChanged",this,"enableUpdate"),this.render()):this.debug("enableUpdate(false)..."),!e)},error:function(e){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("error",arguments))},expandAll:function(e,t){var i=this.enableUpdate(!1);e=!1!==e,this.visit(function(i){!1!==i.hasChildren()&&i.isExpanded()!==e&&i.setExpanded(e,t)}),this.enableUpdate(i)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(e,t){function i(i){if(e(i)&&(r=i),r||i===t)return!1}var n,r=null,o=this.getFirstChild();return e="string"==typeof e?(n=new RegExp("^"+e,"i"),function(e){return n.test(e.title)}):e,t=t||o,this.visitRows(i,{start:t,includeSelf:!1}),r||t===o||this.visitRows(i,{start:o,includeSelf:!0}),r},findRelatedNode:function(t,i,n){var r=null,o=e.ui.keyCode;switch(i){case"parent":case o.BACKSPACE:t.parent&&t.parent.parent&&(r=t.parent);break;case"first":case o.HOME:this.visit(function(e){if(e.isVisible())return r=e,!1});break;case"last":case o.END:this.visit(function(e){e.isVisible()&&(r=e)});break;case"left":case o.LEFT:t.expanded?t.setExpanded(!1):t.parent&&t.parent.parent&&(r=t.parent);break;case"right":case o.RIGHT:t.expanded||!t.children&&!t.lazy?t.children&&t.children.length&&(r=t.children[0]):(t.setExpanded(),r=t);break;case"up":case o.UP:this.visitRows(function(e){return r=e,!1},{start:t,reverse:!0,includeSelf:!1});break;case"down":case o.DOWN:this.visitRows(function(e){return r=e,!1},{start:t,includeSelf:!1});break;default:this.tree.warn("Unknown relation '"+i+"'.")}return r},generateFormElements:function(t,i,n){function r(t){d.append(e("<input>",{type:"checkbox",name:s,value:t.key,checked:!0}))}n=n||{};var o,s="string"==typeof t?t:"ft_"+this._id+"[]",a="string"==typeof i?i:"ft_"+this._id+"_active",l="fancytree_result_"+this._id,d=e("#"+l),c=3===this.options.selectMode&&!1!==n.stopOnParents;d.length?d.empty():d=e("<div>",{id:l}).hide().insertAfter(this.$container),!1!==i&&this.activeNode&&d.append(e("<input>",{type:"radio",name:a,value:this.activeNode.key,checked:!0})),n.filter?this.visit(function(e){var t=n.filter(e);if("skip"===t)return t;!1!==t&&r(e)}):!1!==t&&(o=this.getSelectedNodes(c),e.each(o,function(e,t){r(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(e,t){var i,n;return!t&&(i=document.getElementById(this.options.idPrefix+e))?i.ftnode?i.ftnode:null:(t=t||this.rootNode,n=null,t.visit(function(t){if(t.key===e)return n=t,!1},!0),n)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){3<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("info",arguments))},loadKeyPath:function(t,i){var n,r,o,s=this,a=new e.Deferred,l=this.getRootNode(),d=this.options.keyPathSeparator,c=[],h=e.extend({},i);for("function"==typeof i?n=i:i&&i.callback&&(n=i.callback),h.callback=function(e,t,i){n&&n.call(e,t,i),a.notifyWith(e,[{node:t,status:i}])},null==h.matchKey&&(h.matchKey=function(e,t){return e.key===t}),e.isArray(t)||(t=[t]),r=0;r<t.length;r++)(o=t[r]).charAt(0)===d&&(o=o.substr(1)),c.push(o.split(d));return setTimeout(function(){s._loadKeyPathImpl(a,h,l,c).done(function(){a.resolve()})},0),a.promise()},_loadKeyPathImpl:function(t,i,n,r){var o,s,a,d,c,h,u,f,p,g,v=this;for(u={},s=0;s<r.length;s++)for(p=r[s],f=n;p.length;){if(a=p.shift(),!(d=function(e,t){var n,r,o=e.children;if(o)for(n=0,r=o.length;n<r;n++)if(i.matchKey(o[n],t))return o[n];return null}(f,a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+f+")"),i.callback(this,a,"error");break}if(0===p.length){i.callback(this,d,"ok");break}if(d.lazy&&void 0===d.hasChildren()){i.callback(this,d,"loaded"),u[a=d.key]?u[a].pathSegList.push(p):u[a]={parent:d,pathSegList:[p]};break}i.callback(this,d,"loaded"),f=d}for(c in o=[],u)u.hasOwnProperty(c)&&(h=u[c],g=new e.Deferred,o.push(g),function(e,t,n){i.callback(v,t,"loading"),t.load().done(function(){v._loadKeyPathImpl.call(v,e,i,t,n).always(l(e,v))}).fail(function(n){v.warn("loadKeyPath: error loading lazy "+t),i.callback(v,d,"error"),e.rejectWith(v)})}(g,h.parent,h.pathSegList));return e.when.apply(e,o).promise()},reactivate:function(e){var t,i=this.activeNode;return i?(this.activeNode=null,t=i.setActive(!0,{noFocus:!0}),e&&i.setFocus(),t):s()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(e){this.visit(function(t){t.setSelected(e)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},toDict:function(e,t){var i=this.rootNode.toDict(!0,t);return e?i:i.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,i,n){var r=this._makeHookContext(t,i,n),o=this.widget._trigger(e,i,r);return!1!==o&&void 0!==r.result?r.result:o},_triggerTreeEvent:function(e,t,i){var n=this._makeHookContext(this,t,i),r=this.widget._trigger(e,t,n);return!1!==r&&void 0!==n.result?n.result:r},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(e,t){if(!this.rootNode.children)return!1;if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);var i,n,r,o=0,s=!1===(t=t||{}).includeSelf,a=!!t.includeHidden,l=!a&&this.enableFilter,d=t.start||this.rootNode.children[0];for(n=d.parent;n;){for(i=(r=n.children).indexOf(d)+o;i<r.length;i++)if(d=r[i],!l||d.match||d.subMatchCount){if(!s&&!1===e(d))return!1;if(s=!1,d.children&&d.children.length&&(a||d.expanded)&&!1===d.visit(function(t){return!l||t.match||t.subMatchCount?!1!==e(t)&&(a||!t.children||t.expanded?void 0:"skip"):"skip"},!1))return!1}n=(d=n).parent,o=1}return!0},_visitRowsUp:function(e,t){for(var i,n,r,o=!!t.includeHidden,s=t.start||this.rootNode.children[0];;){if((i=(r=s.parent).children)[0]===s){if(!(s=r).parent)break;i=r.children}else for(n=i.indexOf(s),s=i[n-1];(o||s.expanded)&&s.children&&s.children.length;)s=(i=(r=s).children)[i.length-1];if((o||s.isVisible())&&!1===e(s))return!1}},warn:function(e){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),i("warn",arguments))}},e.extend(f.prototype,{nodeClick:function(e){var t,i,n=e.targetType,r=e.node;if("expander"===n){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===n)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(t=!(i=!1),r.folder)switch(e.options.clickFolderMode){case 2:t=!(i=!0);break;case 3:i=t=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),i&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var i,n,r,o=e.node;if(o.parent)for(n=0,r=(i=o.parent.children).length;n<r;n++)i[n]!==o&&i[n].expanded&&this._callHook("nodeSetExpanded",i[n],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var i,n,r,o=t.originalEvent,s=t.node,a=t.tree,l=t.options,d=o.which,c=o.key||String.fromCharCode(d),h=!!(o.altKey||o.ctrlKey||o.metaKey),u=!k[d]&&!w[d]&&!h,f=e(o.target),p=!0,g=!(o.ctrlKey||!l.autoActivate);if(s||(r=this.getActiveNode()||this.getFirstChild())&&(r.setFocus(),(s=t.node=this.focusNode).debug("Keydown force focus on active node")),l.quicksearch&&u&&!f.is(":input:enabled"))return 500<(n=Date.now())-a.lastQuicksearchTime&&(a.lastQuicksearchTerm=""),a.lastQuicksearchTime=n,a.lastQuicksearchTerm+=c,(i=a.findNextNode(a.lastQuicksearchTerm,a.getActiveNode()))&&i.setActive(),void o.preventDefault();switch(v.eventToString(o)){case"+":case"=":a.nodeSetExpanded(t,!0);break;case"-":a.nodeSetExpanded(t,!1);break;case"space":s.isPagingNode()?a._triggerNodeEvent("clickPaging",t,o):v.evalOption("checkbox",s,s,l,!1)?a.nodeToggleSelected(t):a.nodeSetActive(t,!0);break;case"return":a.nodeSetActive(t,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":s.navigate(o.which,g);break;default:p=!1}p&&o.preventDefault()},nodeLoadChildren:function(i,n){var r,o,s,a,l=i.tree,d=i.node,c=Date.now();return e.isFunction(n)&&(n=n.call(l,{type:"source"},i),t(!e.isFunction(n),"source callback must not return another function")),n.url&&(d._requestId&&d.warn("Recursive load request #"+c+" while #"+d._requestId+" is pending."),r=e.extend({},i.options.ajax,n),d._requestId=c,s=r.debugDelay?(o=r.debugDelay,delete r.debugDelay,e.isArray(o)&&(o=o[0]+Math.random()*(o[1]-o[0])),d.warn("nodeLoadChildren waiting debugDelay "+Math.round(o)+" ms ..."),e.Deferred(function(t){setTimeout(function(){e.ajax(r).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},o)})):e.ajax(r),n=new e.Deferred,s.done(function(t,r,o){var s,a;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof t||e.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),d._requestId&&d._requestId>c)n.rejectWith(this,[b]);else{if(i.options.postProcess){try{a=l._triggerNodeEvent("postProcess",i,i.originalEvent,{response:t,error:null,dataType:this.dataType})}catch(e){a={error:e,message:""+e,details:"postProcess failed"}}if(a.error)return s=e.isPlainObject(a.error)?a.error:{message:a.error},s=l._makeHookContext(d,null,s),void n.rejectWith(this,[s]);(e.isArray(a)||e.isPlainObject(a)&&e.isArray(a.children))&&(t=a)}else t&&t.hasOwnProperty("d")&&i.options.enableAspx&&(t="string"==typeof t.d?e.parseJSON(t.d):t.d);n.resolveWith(this,[t])}}).fail(function(e,t,i){var r=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:i,details:e.status+": "+i});n.rejectWith(this,[r])})),e.isFunction(n.then)&&e.isFunction(n.catch)&&(s=n,n=new e.Deferred,s.then(function(e){n.resolve(e)},function(e){n.reject(e)})),e.isFunction(n.promise)?(l.nodeSetStatus(i,"loading"),n.done(function(e){l.nodeSetStatus(i,"ok"),d._requestId=null}).fail(function(e){var t;e!==b?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=l._makeHookContext(d,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),d.warn("Load children failed ("+t.message+")",t),!1!==l._triggerNodeEvent("loadError",t,null)&&l.nodeSetStatus(i,"error",t.message,t.details)):d.warn("Ignored response for obsolete load request #"+c+" (expected #"+d._requestId+")")})):i.options.postProcess&&(a=l._triggerNodeEvent("postProcess",i,i.originalEvent,{response:n,error:null,dataType:typeof n}),(e.isArray(a)||e.isPlainObject(a)&&e.isArray(a.children))&&(n=a)),e.when(n).done(function(n){var r,o;e.isPlainObject(n)&&(t(d.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),t(e.isArray(n.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),n=(r=n).children,delete r.children,e.each(E,function(e,t){void 0!==r[t]&&(l[t]=r[t],delete r[t])}),e.extend(l.data,r)),t(e.isArray(n),"expected array of children"),d._setChildren(n),l.options.nodata&&0===n.length&&(e.isFunction(l.options.nodata)?o=l.options.nodata.call(l,{type:"nodata"},i):!0===l.options.nodata&&d.isRootNode()?o=l.options.strings.nodata:"string"==typeof l.options.nodata&&d.isRootNode()&&(o=l.options.nodata),o&&d.setStatus("nodata",o)),l._triggerNodeEvent("loadChildren",d)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(i,n){var r,o=i.node,s=e.extend({},i,{node:n}),a=o.children;if(1===a.length)return t(n===a[0],"invalid single child"),this.nodeRemoveChildren(i);this.activeNode&&(n===this.activeNode||this.activeNode.isDescendantOf(n))&&this.activeNode.setActive(!1),this.focusNode&&(n===this.focusNode||this.focusNode.isDescendantOf(n))&&(this.focusNode=null),this.nodeRemoveMarkup(s),this.nodeRemoveChildren(s),t(0<=(r=e.inArray(n,a)),"invalid child"),o.triggerModifyChild("remove",n),n.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,n),a.splice(r,1)},nodeRemoveChildMarkup:function(t){var i=t.node;i.ul&&(i.isRootNode()?e(i.ul).empty():(e(i.ul).remove(),i.ul=null),i.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(e){var t=e.tree,i=e.node;i.children&&(this.activeNode&&this.activeNode.isDescendantOf(i)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(i)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),i.triggerModifyChild("remove",null),i.visit(function(e){e.parent=null,t._callHook("treeRegisterNode",t,!1,e)}),i.lazy?i.children=[]:i.children=null,i.isRootNode()||(i.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(t){var i=t.node;i.li&&(e(i.li).remove(),i.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(i,n,r,o,s){var a,l,d,c,h,u,f,p=i.node,g=i.tree,v=i.options,y=v.aria,m=!1,b=p.parent,x=!b,_=p.children,w=null;if(!1!==g._enableUpdate&&(x||b.ul)){if(t(x||b.ul,"parent UL must exist"),x||(p.li&&(n||p.li.parentNode!==p.parent.ul)&&(p.li.parentNode===p.parent.ul?w=p.li.nextSibling:this.debug("Unlinking "+p+" (must be child of "+p.parent+")"),this.nodeRemoveMarkup(i)),p.li?this.nodeRenderStatus(i):(m=!0,p.li=document.createElement("li"),(p.li.ftnode=p).key&&v.generateIds&&(p.li.id=v.idPrefix+p.key),p.span=document.createElement("span"),p.span.className="fancytree-node",y&&!p.tr&&e(p.li).attr("role","treeitem"),p.li.appendChild(p.span),this.nodeRenderTitle(i),v.createNode&&v.createNode.call(g,{type:"createNode"},i)),v.renderNode&&v.renderNode.call(g,{type:"renderNode"},i)),_){if(x||p.expanded||!0===r){for(p.ul||(p.ul=document.createElement("ul"),(!0!==o||s)&&p.expanded||(p.ul.style.display="none"),y&&e(p.ul).attr("role","group"),p.li?p.li.appendChild(p.ul):p.tree.$div.append(p.ul)),c=0,h=_.length;c<h;c++)f=e.extend({},i,{node:_[c]}),this.nodeRender(f,n,r,!1,!0);for(a=p.ul.firstChild;a;)a=(d=a.ftnode)&&d.parent!==p?(p.debug("_fixParent: remove missing "+d,a),u=a.nextSibling,a.parentNode.removeChild(a),u):a.nextSibling;for(a=p.ul.firstChild,c=0,h=_.length-1;c<h;c++)(l=_[c])===(d=a.ftnode)?a=a.nextSibling:p.ul.insertBefore(l.li,d.li)}}else p.ul&&(this.warn("remove child markup for "+p),this.nodeRemoveChildMarkup(i));x||m&&b.ul.insertBefore(p.li,w)}},nodeRenderTitle:function(t,i){var n,r,o,s,a,l,d,h=t.node,u=t.tree,f=t.options,p=f.aria,g=h.getLevel(),m=[];void 0!==i&&(h.title=i),h.span&&!1!==u._enableUpdate&&(a=p&&!1!==h.hasChildren()?" role='button'":"",g<f.minExpandLevel?(h.lazy||(h.expanded=!0),1<g&&m.push("<span "+a+" class='fancytree-expander fancytree-expander-fixed'></span>")):m.push("<span "+a+" class='fancytree-expander'></span>"),(n=v.evalOption("checkbox",h,h,f,!1))&&!h.isStatusNode()&&(a=p?" role='checkbox'":"",r="fancytree-checkbox",("radio"===n||h.parent&&h.parent.radiogroup)&&(r+=" fancytree-radio"),m.push("<span "+a+" class='"+r+"'></span>")),void 0!==h.data.iconClass&&(h.icon?e.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(h.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),h.icon=h.data.iconClass)),!1!==(o=v.evalOption("icon",h,h,f,!0))&&(a=p?" role='presentation'":"",d=(d=v.evalOption("iconTooltip",h,h,f,null))?" title='"+c(d)+"'":"","string"==typeof o?y.test(o)?(o="/"===o.charAt(0)?o:(f.imagePath||"")+o,m.push("<img src='"+o+"' class='fancytree-icon'"+d+" alt='' />")):m.push("<span "+a+" class='fancytree-custom-icon "+o+"'"+d+"></span>"):o.text?m.push("<span "+a+" class='fancytree-custom-icon "+(o.addClass||"")+"'"+d+">"+v.escapeHtml(o.text)+"</span>"):o.html?m.push("<span "+a+" class='fancytree-custom-icon "+(o.addClass||"")+"'"+d+">"+o.html+"</span>"):m.push("<span "+a+" class='fancytree-icon'"+d+"></span>")),s="",f.renderTitle&&(s=f.renderTitle.call(u,{type:"renderTitle"},t)||""),s||(!0===(l=v.evalOption("tooltip",h,h,f,null))&&(l=h.title),s="<span class='fancytree-title'"+(l=l?" title='"+c(l)+"'":"")+(f.titlesTabbable?" tabindex='0'":"")+">"+(f.escapeTitles?v.escapeHtml(h.title):h.title)+"</span>"),m.push(s),h.span.innerHTML=m.join(""),this.nodeRenderStatus(t),f.enhanceTitle&&(t.$title=e(">span.fancytree-title",h.span),s=f.enhanceTitle.call(u,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var i,n=t.node,r=t.tree,o=t.options,s=n.hasChildren(),a=n.isLastSibling(),l=o.aria,d=o._classNames,c=[],h=n[r.statusClassPropName];h&&!1!==r._enableUpdate&&(l&&(i=e(n.tr||n.li)),c.push(d.node),r.activeNode===n&&c.push(d.active),r.focusNode===n&&c.push(d.focused),n.expanded&&c.push(d.expanded),l&&(!1===s?i.removeAttr("aria-expanded"):i.attr("aria-expanded",Boolean(n.expanded))),n.folder&&c.push(d.folder),!1!==s&&c.push(d.hasChildren),a&&c.push(d.lastsib),n.lazy&&null==n.children&&c.push(d.lazy),n.partload&&c.push(d.partload),n.partsel&&c.push(d.partsel),v.evalOption("unselectable",n,n,o,!1)&&c.push(d.unselectable),n._isLoading&&c.push(d.loading),n._error&&c.push(d.error),n.statusNodeType&&c.push(d.statusNodePrefix+n.statusNodeType),n.selected?(c.push(d.selected),l&&i.attr("aria-selected",!0)):l&&i.attr("aria-selected",!1),n.extraClasses&&c.push(n.extraClasses),!1===s?c.push(d.combinedExpanderPrefix+"n"+(a?"l":"")):c.push(d.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(a?"l":"")),c.push(d.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),h.className=c.join(" "),n.li&&e(n.li).toggleClass(d.lastsib,a))},nodeSetActive:function(i,n,r){r=r||{};var o,l=i.node,d=i.tree,c=i.options,h=!0===r.noEvents,u=!0===r.noFocus,f=!1!==r.scrollIntoView;return l===d.activeNode==(n=!1!==n)?s(l):n&&!h&&!1===this._triggerNodeEvent("beforeActivate",l,i.originalEvent)?a(l,["rejected"]):(n?(d.activeNode&&(t(d.activeNode!==l,"node was active (inconsistency)"),o=e.extend({},i,{node:d.activeNode}),d.nodeSetActive(o,!1),t(null===d.activeNode,"deactivate was out of sync?")),c.activeVisible&&l.makeVisible({scrollIntoView:f}),d.activeNode=l,d.nodeRenderStatus(i),u||d.nodeSetFocus(i),h||d._triggerNodeEvent("activate",l,i.originalEvent)):(t(d.activeNode===l,"node was not active (inconsistency)"),d.activeNode=null,this.nodeRenderStatus(i),h||i.tree._triggerNodeEvent("deactivate",l,i.originalEvent)),s(l))},nodeSetExpanded:function(t,i,n){n=n||{};var r,o,l,d,c,h,u=t.node,f=t.tree,p=t.options,g=!0===n.noAnimation,v=!0===n.noEvents;if(i=!1!==i,u.expanded&&i||!u.expanded&&!i)return s(u);if(i&&!u.lazy&&!u.hasChildren())return s(u);if(!i&&u.getLevel()<p.minExpandLevel)return a(u,["locked"]);if(!v&&!1===this._triggerNodeEvent("beforeExpand",u,t.originalEvent))return a(u,["rejected"]);if(g||u.isVisible()||(g=n.noAnimation=!0),o=new e.Deferred,i&&!u.expanded&&p.autoCollapse){c=u.getParentList(!1,!0),h=p.autoCollapse;try{for(p.autoCollapse=!1,l=0,d=c.length;l<d;l++)this._callHook("nodeCollapseSiblings",c[l],n)}finally{p.autoCollapse=h}}return o.done(function(){var e=u.getLastChild();i&&p.autoScroll&&!g&&e?e.scrollIntoView(!0,{topNode:u}).always(function(){v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}):v||t.tree._triggerNodeEvent(i?"expand":"collapse",t)}),r=function(n){var r=p._classNames,o=p.toggleEffect;if(u.expanded=i,f._callHook("treeStructureChanged",t,i?"expand":"collapse"),f._callHook("nodeRender",t,!1,!1,!0),u.ul)if("none"!==u.ul.style.display==!!u.expanded)u.warn("nodeSetExpanded: UL.style.display already set");else{if(o&&!g)return e(u.li).addClass(r.animating),void(e.isFunction(e(u.ul)[o.effect])?(f.debug("use jquery."+o.effect+" method"),e(u.ul)[o.effect]({duration:o.duration,always:function(){e(this).removeClass(r.animating),e(u.li).removeClass(r.animating),n()}})):(e(u.ul).stop(!0,!0),e(u.ul).parent().find(".ui-effects-placeholder").remove(),e(u.ul).toggle(o.effect,o.options,o.duration,function(){e(this).removeClass(r.animating),e(u.li).removeClass(r.animating),n()})));u.ul.style.display=u.expanded||!parent?"":"none"}n()},i&&u.lazy&&void 0===u.hasChildren()?u.load().done(function(){o.notifyWith&&o.notifyWith(u,["loaded"]),r(function(){o.resolveWith(u)})}).fail(function(e){r(function(){o.rejectWith(u,["load failed ("+e+")"])})}):r(function(){o.resolveWith(u)}),o.promise()},nodeSetFocus:function(t,i){var n,r=t.tree,o=t.node,s=r.options,a=!!t.originalEvent&&e(t.originalEvent.target).is(":input");if(i=!1!==i,r.focusNode){if(r.focusNode===o&&i)return;n=e.extend({},t,{node:r.focusNode}),r.focusNode=null,this._triggerNodeEvent("blur",n),this._callHook("nodeRenderStatus",n)}i&&(this.hasFocus()||(o.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),o.makeVisible({scrollIntoView:!1}),r.focusNode=o,s.titlesTabbable&&(a||e(o.span).find(".fancytree-title").focus()),s.aria&&e(r.$container).attr("aria-activedescendant",e(o.tr||o.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",t),document.activeElement===r.$container.get(0)||1<=e(document.activeElement,r.$container).length||e(r.$container).focus(),s.autoScroll&&o.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(e,t,i){i=i||{};var n=e.node,r=e.tree,o=e.options,s=!0===i.noEvents,a=n.parent;if(t=!1!==t,!v.evalOption("unselectable",n,n,o,!1)){if(n._lastSelectIntent=t,!!n.selected===t&&(3!==o.selectMode||!n.partsel||t))return t;if(!s&&!1===this._triggerNodeEvent("beforeSelect",n,e.originalEvent))return!!n.selected;t&&1===o.selectMode?(r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1),n.selected=t):3!==o.selectMode||!a||a.radiogroup||n.radiogroup?a&&a.radiogroup?n.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===n)},!0):n.selected=t:(n.selected=t,n.fixSelection3AfterClick(i)),this.nodeRenderStatus(e),r.lastSelectedNode=t?n:null,s||r._triggerNodeEvent("select",e)}},nodeSetStatus:function(t,i,n,r){function o(i,n){var r=s.children?s.children[0]:null;return r&&r.isStatusNode()?(e.extend(r,i),r.statusNodeType=n,a._callHook("nodeRenderTitle",r)):(s._setChildren([i]),a._callHook("treeStructureChanged",t,"setStatusNode"),s.children[0].statusNodeType=n,a.render()),s.children[0]}var s=t.node,a=t.tree;switch(i){case"ok":!function(){var e=s.children?s.children[0]:null;if(e&&e.isStatusNode()){try{s.ul&&(s.ul.removeChild(e.li),e.li=null)}catch(e){}1===s.children.length?s.children=[]:s.children.shift(),a._callHook("treeStructureChanged",t,"clearStatusNode")}}(),s._isLoading=!1,s._error=null,s.renderStatus();break;case"loading":s.parent||o({title:a.options.strings.loading+(n?" ("+n+")":""),checkbox:!1,tooltip:r},i),s._isLoading=!0,s._error=null,s.renderStatus();break;case"error":o({title:a.options.strings.loadError+(n?" ("+n+")":""),checkbox:!1,tooltip:r},i),s._isLoading=!1,s._error={message:n,details:r},s.renderStatus();break;case"nodata":o({title:n||a.options.strings.noData,checkbox:!1,tooltip:r},i),s._isLoading=!1,s._error=null,s.renderStatus();break;default:e.error("invalid node status "+i)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,i=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(i=!1,t.selected=!0),t._lastSelectIntent=i,this.nodeSetSelected(e,i)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null,t._callHook("treeStructureChanged",e,"clear")},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(t){var i=t.tree,n=i.options;i.$container.attr("tabindex",n.tabindex),
e.each(E,function(e,t){void 0!==n[t]&&(i.info("Move option "+t+" to tree"),i[t]=n[t],delete n[t])}),n.checkboxAutoHide&&i.$container.addClass("fancytree-checkbox-auto-hide"),n.rtl?i.$container.attr("DIR","RTL").addClass("fancytree-rtl"):i.$container.removeAttr("DIR").removeClass("fancytree-rtl"),n.aria&&(i.$container.attr("role","tree"),1!==n.selectMode&&i.$container.attr("aria-multiselectable",!0)),this.treeLoad(t)},treeLoad:function(i,n){var r,o,s,a=i.tree,l=i.widget.element,c=e.extend({},i,{node:this.rootNode});if(a.rootNode.children&&this.treeClear(i),n=n||this.options.source)"string"==typeof n&&e.error("Not implemented");else switch(o=l.data("type")||"html"){case"html":(s=l.find(">ul").first()).addClass("ui-fancytree-source fancytree-helper-hidden"),n=e.ui.fancytree.parseHtml(s),this.data=e.extend(this.data,d(s));break;case"json":n=e.parseJSON(l.text()),l.contents().filter(function(){return 3===this.nodeType}).remove(),e.isPlainObject(n)&&(t(e.isArray(n.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),n=(r=n).children,delete r.children,e.each(E,function(e,t){void 0!==r[t]&&(a[t]=r[t],delete r[t])}),e.extend(a.data,r));break;default:e.error("Invalid data-type: "+o)}return this.nodeLoadChildren(c,n).done(function(){a._callHook("treeStructureChanged",i,"loadChildren"),a.render(),3===i.options.selectMode&&a.rootNode.fixSelection3FromEndNodes(),a.activeNode&&a.options.activeVisible&&a.activeNode.makeVisible(),a._triggerTreeEvent("init",null,{status:!0})}).fail(function(){a.render(),a._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,i){e.tree._callHook("treeStructureChanged",e,t?"addNode":"removeNode")},treeSetFocus:function(t,i,n){var r;(i=!1!==i)!==this.hasFocus()&&(!(this._hasFocus=i)&&this.focusNode?this.focusNode.setFocus(!1):!i||n&&n.calledByNode||e(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",i),this._triggerTreeEvent(i?"focusTree":"blurTree"),i&&!this.activeNode&&(r=this._lastMousedownNode||this.getFirstChild())&&r.setFocus())},treeSetOption:function(t,i,n){var r=t.tree,o=!0,s=!1,a=!1;switch(i){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":a=s=!0;break;case"checkboxAutoHide":r.$container.toggleClass("fancytree-checkbox-auto-hide",!!n);break;case"escapeTitles":case"tooltip":a=!0;break;case"rtl":!1===n?r.$container.removeAttr("DIR").removeClass("fancytree-rtl"):r.$container.attr("DIR","RTL").addClass("fancytree-rtl"),a=!0;break;case"source":o=!1,r._callHook("treeLoad",r,n),a=!0}r.debug("set option "+i+"="+n+" <"+typeof n+">"),o&&(this.widget._super?this.widget._super.call(this.widget,i,n):e.Widget.prototype._setOption.call(this.widget,i,n)),s&&r._callHook("treeCreate",r),a&&r.render(!0,!1)},treeStructureChanged:function(e,t){}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"slideToggle",duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,treeId:null,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new f(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul").first();var i,r,s,a=this.options,l=a.extensions;for(this.tree,s=0;s<l.length;s++)r=l[s],(i=e.ui.fancytree._extensions[r])||e.error("Could not apply extension '"+r+"' (it is not registered, did you forget to include it?)"),this.tree.options[r]=n({},i.options,this.tree.options[r]),t(void 0===this.tree.ext[r],"Extension name must not exist as Fancytree.ext attribute: '"+r+"'"),this.tree.ext[r]={},o(this.tree,0,i,r);void 0!==a.icons&&(!0===a.icon?(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),a.icon=a.icons):e.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead")),void 0!==a.iconClass&&(a.icon?e.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),a.icon=a.iconClass)),void 0!==a.tabbable&&(a.tabindex=a.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+a.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.off(t),this.tree.$container.off(t),e(document).off(t)},_bind:function(){var t=this,i=this.options,n=this.tree,r=n._ns;this._unbind(),n.$container.on("focusin"+r+" focusout"+r,function(t){var i=v.getNode(t),r="focusin"===t.type;if(!r&&i&&e(t.target).is("a"))i.debug("Ignored focusout on embedded <a> element.");else{if(r){if(n._getExpiringValue("focusin"))return void n.debug("Ignored double focusin.");n._setExpiringValue("focusin",!0,50),i||(i=n._getExpiringValue("mouseDownNode"))&&n.debug("Reconstruct mouse target for focusin from recent event.")}i?n._callHook("nodeSetFocus",n._makeHookContext(i,t),r):n.tbody&&e(t.target).parents("table.fancytree-container > thead").length?n.debug("Ignore focus event outside table body.",t):n._callHook("treeSetFocus",n,r)}}).on("selectstart"+r,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+r,function(e){if(i.disabled||!1===i.keyboard)return!0;var t,r=n.focusNode,o=n._makeHookContext(r||n,e),s=n.phase;try{return n.phase="userEvent","preventNav"===(t=r?n._triggerNodeEvent("keydown",r,e):n._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=n._callHook("nodeKeydown",o)),t}finally{n.phase=s}}).on("mousedown"+r,function(e){var t=v.getEventTarget(e);n._lastMousedownNode=t?t.node:null,n._setExpiringValue("mouseDownNode",n._lastMousedownNode)}).on("click"+r+" dblclick"+r,function(e){if(i.disabled)return!0;var n,r=v.getEventTarget(e),o=r.node,s=t.tree,a=s.phase;if(!o)return!0;n=s._makeHookContext(o,e);try{switch(s.phase="userEvent",e.type){case"click":return n.targetType=r.type,o.isPagingNode()?!0===s._triggerNodeEvent("clickPaging",n,e):!1!==s._triggerNodeEvent("click",n,e)&&s._callHook("nodeClick",n);case"dblclick":return n.targetType=r.type,!1!==s._triggerNodeEvent("dblclick",n,e)&&s._callHook("nodeDblclick",n)}}finally{s.phase=a}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),v=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.31.0",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:f,_FancytreeNodeClass:u,jquerySupports:{positionMyOfs:function(t,i,n,r){var o,s,a,l=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),d=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(o=0;o<d.length;o++)if((s=l[o]||0)!==(a=d[o]||0))return a<s;return!0}(e.ui.version,1,9)},assert:function(e,i){return t(e,i)},createTree:function(t,i){return e(t).fancytree(i).fancytree("getTree")},debounce:function(e,t,i,n){var r;return 3===arguments.length&&"boolean"!=typeof i&&(n=i,i=!1),function(){var o=arguments;n=n||this,i&&!r&&t.apply(n,o),clearTimeout(r),r=setTimeout(function(){i||t.apply(n,o),r=null},e)}},debug:function(t){4<=e.ui.fancytree.debugLevel&&i("log",arguments)},error:function(t){1<=e.ui.fancytree.debugLevel&&i("error",arguments)},escapeHtml:function(e){return(""+e).replace(/[&<>"'\/]/g,function(e){return x[e]})},fixPositionOptions:function(t){if((t.offset||0<=(""+t.my+t.at).indexOf("%"))&&e.error("expected new position syntax (but '%' is not supported)"),!e.ui.fancytree.jquerySupports.positionMyOfs){var i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),r=(i[2]?+i[2]:0)+(n[2]?+n[2]:0),o=(i[4]?+i[4]:0)+(n[4]?+n[4]:0);t=e.extend({},t,{my:i[1]+" "+i[3],at:n[1]+" "+n[3]}),(r||o)&&(t.offset=r+" "+o)}return t},getEventTarget:function(t){var i,n=t&&t.target?t.target.className:"",r={node:this.getNode(t.target),type:void 0};return/\bfancytree-title\b/.test(n)?r.type="title":/\bfancytree-expander\b/.test(n)?r.type=!1===r.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(n)?r.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(n)?r.type="icon":/\bfancytree-node\b/.test(n)?r.type="title":t&&t.target&&((i=e(t.target)).is("ul[role=group]")?((r.node&&r.node.tree||v).debug("Ignoring click on outer UL."),r.node=null):i.closest(".fancytree-title").length?r.type="title":i.closest(".fancytree-checkbox").length?r.type="checkbox":i.closest(".fancytree-expander").length&&(r.type="expander")),r},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(t){if(t instanceof u)return t;for(t instanceof e?t=t[0]:void 0!==t.originalEvent&&(t=t.target);t;){if(t.ftnode)return t.ftnode;t=t.parentNode}return null},getTree:function(t){var i,n=t;return t instanceof f?t:(void 0===t&&(t=0),"number"==typeof t?t=e(".fancytree-container").eq(t):"string"==typeof t?(t=e("#ft-id-"+n).eq(0)).length||(t=e(n).eq(0)):t instanceof e?t=t.eq(0):void 0!==t.originalEvent&&(t=e(t.target)),(i=(t=t.closest(":ui-fancytree")).data("ui-fancytree")||t.data("fancytree"))?i.tree:null)},evalOption:function(t,i,n,r,o){var s,a,l=i.tree,d=r[t],c=n[t];return e.isFunction(d)?(s={node:i,tree:l,widget:l.widget,options:l.widget.options,typeInfo:l.types[i.type]||{}},null==(a=d.call(l,{type:t},s))&&(a=c)):a=null==c?d:c,null==a&&(a=o),a},setSpanIcon:function(t,i,n){var r=e(t);"string"==typeof n?r.attr("class",i+" "+n):(n.text?r.text(""+n.text):n.html&&(t.innerHTML=n.html),r.attr("class",i+" "+(n.addClass||"")))},eventToString:function(e){var t=e.which,i=e.type,n=[];return e.altKey&&n.push("alt"),e.ctrlKey&&n.push("ctrl"),e.metaKey&&n.push("meta"),e.shiftKey&&n.push("shift"),"click"===i||"dblclick"===i?n.push(C[e.button]+i):"wheel"===i?n.push(i):_[t]||n.push(w[t]||String.fromCharCode(t).toLowerCase()),n.join("+")},info:function(t){3<=e.ui.fancytree.debugLevel&&i("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(t,i,n,r){var o,s=t[i]||e.noop;t[i]=function(){var e=r||this;try{return o=e._super,e._super=s,n.apply(e,arguments)}finally{e._super=o}}},parseHtml:function(t){var i,n,r,o,s,a,l,c,h=t.find(">li"),u=[];return h.each(function(){var h,f,p=e(this),g=p.find(">span",this).first(),v=g.length?null:p.find(">a").first(),y={tooltip:null,data:{}};for(g.length?y.title=g.html():v&&v.length?(y.title=v.html(),y.data.href=v.attr("href"),y.data.target=v.attr("target"),y.tooltip=v.attr("title")):(y.title=p.html(),0<=(s=y.title.search(/<ul/i))&&(y.title=y.title.substring(0,s))),y.title=e.trim(y.title),o=0,a=N.length;o<a;o++)y[N[o]]=void 0;for(i=this.className.split(" "),r=[],o=0,a=i.length;o<a;o++)n=i[o],S[n]?y[n]=!0:r.push(n);if(y.extraClasses=r.join(" "),(l=p.attr("title"))&&(y.tooltip=l),(l=p.attr("id"))&&(y.key=l),p.attr("hideCheckbox")&&(y.checkbox=!1),(h=d(p))&&!e.isEmptyObject(h)){for(f in H)h.hasOwnProperty(f)&&(h[H[f]]=h[f],delete h[f]);for(o=0,a=T.length;o<a;o++)l=T[o],null!=(c=h[l])&&(delete h[l],y[l]=c);e.extend(y.data,h)}(t=p.find(">ul").first()).length?y.children=e.ui.fancytree.parseHtml(t):y.children=y.lazy?void 0:null,u.push(y)}),u},registerExtension:function(i){t(null!=i.name,"extensions must have a `name` property."),t(null!=i.version,"extensions must have a `version` property."),e.ui.fancytree._extensions[i.name]=i},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(t){2<=e.ui.fancytree.debugLevel&&i("warn",arguments)}}),e.ui.fancytree}e.ui.fancytree.warn("Fancytree: ignored duplicate include")}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";function t(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var i=e.ui.fancytree.escapeHtml;return e.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(n,r,o){var s,a,l,d,c,h,u=0,f=this.options,p=f.escapeTitles,g=f.autoCollapse,v=e.extend({},f.filter,o),y="hide"===v.mode,m=!!v.leavesOnly&&!r;if("string"==typeof n){if(""===n)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();s=v.fuzzy?n.split("").reduce(function(e,t){return e+"[^"+t+"]*"+t}):t(n),l=new RegExp(".*"+s+".*","i"),d=new RegExp(t(n),"gi"),n=function(t){if(!t.title)return!1;var n,r=p?t.title:(n=t.title).indexOf(">")>=0?e("<div/>").html(n).text():n,o=!!l.test(r);return o&&v.highlight&&(p?(c=r.replace(d,function(e){return""+e+""}),t.titleWithHighlight=i(c).replace(/\uFFF7/g,"<mark>").replace(/\uFFF8/g,"</mark>")):t.titleWithHighlight=r.replace(d,function(e){return"<mark>"+e+"</mark>"})),o}}return this.enableFilter=!0,this.lastFilterArgs=arguments,h=this.enableUpdate(!1),this.$div.addClass("fancytree-ext-filter"),y?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!v.hideExpanders),this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(a=this.getRootNode()._findDirectChild("__not_found__"))&&a.remove(),f.autoCollapse=!1,this.visit(function(e){if(!m||null==e.children){var t=n(e),i=!1;if("skip"===t)return e.visit(function(e){e.match=!1},!0),"skip";t||!r&&"branch"!==t||!e.parent.match||(t=!0,i=!0),t&&(u++,e.match=!0,e.visitParents(function(e){e.subMatchCount+=1,!v.autoExpand||i||e.expanded||(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)}))}}),f.autoCollapse=g,0===u&&v.nodata&&y&&(a=v.nodata,e.isFunction(a)&&(a=a()),!0===a?a={}:"string"==typeof a&&(a={title:a}),a=e.extend({statusNodeType:"nodata",key:"__not_found__",title:this.options.strings.noData},a),this.getRootNode().addNode(a).match=!0),this._callHook("treeStructureChanged",this,"applyFilter"),this.enableUpdate(h),u},e.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},e.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,i=this.getRootNode()._findDirectChild("__not_found__"),n=this.options.escapeTitles,r=this.options.enhanceTitle,o=this.enableUpdate(!1);i&&i.remove(),this.visit(function(i){i.match&&i.span&&(t=e(i.span).find(">span.fancytree-title"),n?t.text(i.title):t.html(i.title),r&&r({type:"enhanceTitle"},{node:i,$title:t})),delete i.match,delete i.subMatchCount,delete i.titleWithHighlight,i.$subMatchBadge&&(i.$subMatchBadge.remove(),delete i.$subMatchBadge),i._filterAutoExpanded&&i.expanded&&i.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete i._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this._callHook("treeStructureChanged",this,"clearFilter"),this.enableUpdate(o)},e.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},e.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},e.ui.fancytree.registerExtension({name:"filter",version:"2.31.0",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){var i=e.tree;return this._superApply(arguments).done(function(){i.enableFilter&&i.lastFilterArgs&&e.options.filter.autoApply&&i._applyFilterImpl.apply(i,i.lastFilterArgs)})},nodeSetExpanded:function(e,t,i){var n=e.node;return delete n._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&n.$subMatchBadge&&n.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var i,n=t.node,r=t.tree,o=t.options.filter,s=e(n.span).find("span.fancytree-title"),a=e(n[r.statusClassPropName]),l=t.options.enhanceTitle,d=t.options.escapeTitles;return i=this._super(t),a.length&&r.enableFilter?(a.toggleClass("fancytree-match",!!n.match).toggleClass("fancytree-submatch",!!n.subMatchCount).toggleClass("fancytree-hide",!(n.match||n.subMatchCount)),!o.counter||!n.subMatchCount||n.isExpanded()&&o.hideExpandedCounter?n.$subMatchBadge&&n.$subMatchBadge.hide():(n.$subMatchBadge||(n.$subMatchBadge=e("<span class='fancytree-childcounter'/>"),e("span.fancytree-icon, span.fancytree-custom-icon",n.span).append(n.$subMatchBadge)),n.$subMatchBadge.show().text(n.subMatchCount)),!n.span||n.isEditing&&n.isEditing.call(n)||(n.titleWithHighlight?s.html(n.titleWithHighlight):d?s.text(n.title):s.html(n.title),l&&l({type:"enhanceTitle"},{node:n,$title:s})),i):i}}),e.ui.fancytree});