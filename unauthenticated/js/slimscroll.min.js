/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(a){a.fn.extend({slimScroll:function(b){var c={width:"auto",height:"auto",maxHeight:"none",minHeight:"none",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var d=a.extend(c,b);this.each(function(){var x,r,k,p,A,s,o,j,l="<div></div>",u=30,q=false;var B=a(this);if(B.parent().hasClass(d.wrapperClass)){var h=B.scrollTop();v=B.parent().find("."+d.barClass);e=B.parent().find("."+d.railClass);C();if(a.isPlainObject(b)){if("height" in b&&b.height=="auto"){B.parent().css("height","auto");B.css("height","auto");var n=B.parent().parent().height();B.parent().css("height",n);B.css("height",n)}if("scrollTo" in b){h=parseInt(d.scrollTo)}else{if("scrollBy" in b){h+=parseInt(d.scrollBy)}else{if("destroy" in b){v.remove();e.remove();B.unwrap();return}}}w(h,false,true)}return}else{if(a.isPlainObject(b)){if("destroy" in b){return}}}d.height=(d.height=="auto")?"auto":d.height;var i=a(l).addClass(d.wrapperClass).css({position:"relative",overflow:"hidden",width:d.width,height:d.height,"max-height":d.maxHeight,"min-height":d.minHeight});B.css({overflow:"hidden",width:d.width,height:d.height,"max-height":d.maxHeight});var e=a(l).addClass(d.railClass).css({width:d.size,height:"100%",position:"absolute",top:0,display:(d.alwaysVisible&&d.railVisible)?"block":"none","border-radius":d.railBorderRadius,background:d.railColor,opacity:d.railOpacity,zIndex:90});var v=a(l).addClass(d.barClass).css({background:d.color,width:d.size,position:"absolute",top:0,opacity:d.opacity,display:d.alwaysVisible?"block":"none","border-radius":d.borderRadius,BorderRadius:d.borderRadius,MozBorderRadius:d.borderRadius,WebkitBorderRadius:d.borderRadius,zIndex:99});var f=(d.position=="right")?{right:d.distance}:{left:d.distance};e.css(f);v.css(f);B.wrap(i);B.parent().append(v);B.parent().append(e);if(d.railDraggable){v.bind("mousedown",function(D){var E=a(document);k=true;t=parseFloat(v.css("top"));pageY=D.pageY;E.bind("mousemove.slimscroll",function(F){currTop=t+F.pageY-pageY;v.css("top",currTop);w(0,v.position().top,false)});E.bind("mouseup.slimscroll",function(F){k=false;m();E.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(D){D.stopPropagation();D.preventDefault();return false})}e.hover(function(){g()},function(){m()});v.hover(function(){r=true},function(){r=false});B.hover(function(){x=true;g();m()},function(){x=false;m()});B.bind("touchstart",function(E,D){if(E.originalEvent.touches.length){A=E.originalEvent.touches[0].pageY}});B.bind("touchmove",function(E){if(!q){E.originalEvent.preventDefault()}if(E.originalEvent.touches.length){var D=(A-E.originalEvent.touches[0].pageY)/d.touchScrollStep;w(D,true);A=E.originalEvent.touches[0].pageY}});C();if(d.start==="bottom"){v.css({top:B.outerHeight()-v.outerHeight()});w(0,true)}else{if(d.start!=="top"){w(a(d.start).position().top,null,true);if(!d.alwaysVisible){v.hide()}}}y();function z(E){if(!x){return}var E=E||window.event;var F=0;if(E.wheelDelta){F=-E.wheelDelta/120}if(E.detail){F=E.detail/3}var D=E.target||E.srcTarget||E.srcElement;if(a(D).closest("."+d.wrapperClass).is(B.parent())){w(F,true)}if(E.preventDefault&&!q){E.preventDefault()}if(!q){E.returnValue=false}}function w(I,F,D){q=false;var H=I;var G=B.outerHeight()-v.outerHeight();if(F){H=parseInt(v.css("top"))+I*parseInt(d.wheelStep)/100*v.outerHeight();H=Math.min(Math.max(H,0),G);H=(I>0)?Math.ceil(H):Math.floor(H);v.css({top:H+"px"})}o=parseInt(v.css("top"))/(B.outerHeight()-v.outerHeight());H=o*(B[0].scrollHeight-B.outerHeight());if(D){H=I;var E=H/B[0].scrollHeight*B.outerHeight();E=Math.min(Math.max(E,0),G);v.css({top:E+"px"})}B.scrollTop(H);B.trigger("slimscrolling",~~H);g();m()}function y(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",z,false);this.addEventListener("mousewheel",z,false)}else{document.attachEvent("onmousewheel",z)}}function C(){s=Math.max((B.outerHeight()/B[0].scrollHeight)*B.outerHeight(),u);v.css({height:s+"px"});var D=s==B.outerHeight()?"none":"block";v.css({display:D})}function g(){C();clearTimeout(p);if(o==~~o){q=d.allowPageScroll;if(j!=o){var D=(~~o==0)?"top":"bottom";B.trigger("slimscroll",D)}}else{q=false}j=o;if(s>=B.outerHeight()){q=true;return}v.stop(true,true).fadeIn("fast");if(d.railVisible){e.stop(true,true).fadeIn("fast")}}function m(){if(!d.alwaysVisible){p=setTimeout(function(){if(!(d.disableFadeOut&&x)&&!r&&!k){v.fadeOut("slow");e.fadeOut("slow")}},1000)}}});return this}});a.fn.extend({slimscroll:a.fn.slimScroll})})(jQuery);