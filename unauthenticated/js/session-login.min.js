try{const e=document.querySelector("html"),t="data-platform";if(navigator.userAgentData&&navigator.userAgentData.platform){const n=navigator.userAgentData.platform.toLowerCase();n.includes("linux")?e.setAttribute(t,"linux"):n.includes("windows")?e.setAttribute(t,"windows"):n.includes("mac")&&e.setAttribute(t,"macos")}else if(navigator.platform){const n=navigator.platform.toLowerCase();n.includes("linux")?e.setAttribute(t,"linux"):n.includes("win")?e.setAttribute(t,"windows"):n.includes("mac")&&e.setAttribute(t,"macos")}}catch(e){console.warn("Failed to detect platform:",e)}function theme_spinner(e,t,n){const r="cspinner_container";if(e=e||(document.querySelector("button i.fa-sign-in:not(.invisible)")||document.querySelector("button i.fa-qrcode:not(.invisible)")),s='<span class="'+r+'"><span class="cspinner"><span class="cspinner-icon white small"></span></span></span>',e&&!t)e.classList.add("invisible"),e.insertAdjacentHTML("afterend",s),e.parentNode.classList.add("disabled"),e.parentNode.disabled=!0;else if(e&&t){e.classList.remove("invisible"),e.parentNode.classList.remove("disabled"),e.parentNode.disabled=!1;const t=e.parentNode.querySelector("."+r);t&&t.parentNode.removeChild(t),n&&(e.className="fa2 fa2-marker-check",e.parentNode.classList.add("disabled"))}}function theme_content_loaded(){const e="object"==typeof theme_language?theme_language:{},t=".container.session_login",n=".session_login_back.forgot",r=document.querySelector('input[name="user"]'),o=document.querySelector('input[name="pass"]'),s=function(e,t){const n=(e?"faa-bounce animated":"faa-horizontal animated").split(" ");t.classList.add(...n),setTimeout(()=>{t.classList.remove(...n)},1500)};function i(t,n,r){const o=".container.session_login";let i=document.querySelector(o+" > .alert");i&&i.remove(),i=document.createElement("div"),i.className="alert",i.innerHTML='\n            <strong><i class="fa"></i> </strong><br>\n            <span></span>';const a=document.querySelector(o);a&&a.insertBefore(i,a.firstChild),i.classList.remove("alert-warning","alert-success","alert-danger");const c=i.querySelector(".fa"),l=i.querySelector("strong"),u=i.querySelector("span");"success"===t?(s(!0,i),i.classList.add("alert-success"),r||(r="check-circle"),c&&(c.className="fa fa-"+r),l&&(l.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_success),u&&(u.innerHTML=n)):(s(!1,i),i.classList.add("alert-danger"),r||(r="exclamation-circle"),c&&(c.className="fa fa-"+r),l&&(l.innerHTML='<i class="fa fa-'+r+'"></i> '+e.session_error),u&&(u.textContent=n))}document.querySelectorAll('input[type="password"]').forEach(e=>{const t=document.createElement("span");t.classList.add("input_warning_caps"),t.setAttribute("title","Caps Lock"),t.classList.add("large"),e.classList.add("use_input_warning_caps"),e.parentNode.insertBefore(t,e.nextSibling),e.addEventListener("blur",function(){this.nextSibling.classList.remove("visible")}),e.addEventListener("keydown",function(e){if("function"==typeof e.getModifierState){let t;t=20===e.keyCode?!e.getModifierState("CapsLock"):e.getModifierState("CapsLock"),t?this.nextSibling.classList.add("visible"):this.nextSibling.classList.remove("visible")}})}),function(){const n=document.querySelector('[name="twofactor"]'),a=function(n){n||(n=document);if(!n.querySelector('form[action*="password_change.cgi"]'))return!1;const r=document.querySelector(t),s=n.querySelector(t),a="string"==typeof serverRedirectUrl?serverRedirectUrl:function(){const e=location.pathname,t=e.substring(0,e.lastIndexOf("/")+1);return location.origin+t}();if(r&&s){r.innerHTML=s.innerHTML;const t=r.querySelector('form[action*="password_change.cgi"]');if(t){t.removeAttribute("onsubmit");const n=t.querySelector('input[name="old"]');if(n&&null!==o){const e=n.closest(".input-group");e&&e.remove();const r=document.createElement("input");r.type="hidden",r.name="old",r.value=o.value,t.prepend(r)}const r=t.querySelector('input[name="new1"]');r&&r.focus();const s=t.querySelector('button[type="submit"]'),c=s?s.querySelector("i"):null;t.addEventListener("submit",async function(n){n.preventDefault(),c&&theme_spinner(c);try{const e=new URLSearchParams;for(let n=0;n<t.elements.length;n++){const r=t.elements[n];r.name&&"submit"!==r.type&&"button"!==r.type&&e.append(r.name,r.value||"")}const n=await fetch(t.action,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}),r=await n.text(),o=(new DOMParser).parseFromString(r,"text/html"),s=o.querySelector(".alert-success"),l=o.querySelector(".alert-danger, .alert-warning");s?(sessionStorage.setItem("login_message",JSON.stringify({type:"success",text:s.textContent.trim()})),location.href=a):l&&(c&&theme_spinner(c,!0),i("error",l.textContent.trim()))}catch(t){c&&theme_spinner(c,!0),i("error",e.session_unkerror)}})}}return!0},c=sessionStorage.getItem("login_message");if(c){const e=JSON.parse(c);sessionStorage.removeItem("login_message"),i(e.type,e.text)}if(n){const i=document.querySelector('[data-submit="2fa"]'),c=i.querySelector("i"),l=i.getAttribute("data-prefix"),u=location.origin+(l||""),d=document.querySelector('[name="save"]'),m=n.closest("form"),f=m.getAttribute("action")||url.toString(),p=function(i){i.preventDefault(),theme_spinner(c);const a=new URLSearchParams;a.append("user",r.value),a.append("pass",o.value),d&&a.append("save",d.checked?1:0),a.append("twofactor",n.value),fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(t=>{if(t.url&&(h=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(e=>{const n=(new DOMParser).parseFromString(e,"text/html");if(n.querySelector(t)){theme_spinner(c,!0);const e=document.querySelector(t);e.querySelectorAll(".alert").forEach(e=>e.remove());const r=n.querySelector(".alert");return void(r&&(e.insertBefore(r.cloneNode(!0),e.firstChild),s(!1,e.querySelector(".alert"))))}location.href=h}).catch(e=>{location.href=h})};let h=u;n&&n.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),i&&i.click(),!1}),m.addEventListener("submit",async function(s){s.preventDefault();try{const s=new URLSearchParams;s.append("user",r.value),s.append("pass",o.value),d&&s.append("save",d.checked?1:0),s.append("twofprobe",1);const c=await fetch(f,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s});if(c.url&&(h=c.url),401===c.status){const e=document.querySelector(".session_login_flipper");e.classList.toggle("flipped"),e.classList.toggle("twofactor");const t=document.querySelector(".alert");return t&&t.remove(),setTimeout(()=>{n.focus()},600),i.removeEventListener("click",p),void i.addEventListener("click",p)}if(!c.ok){const t=await c.text();throw new Error(e.session_neterror,{cause:{status:c.status,statusText:c.statusText,url:c.url,body:t,headers:Object.fromEntries(c.headers.entries())}})}const l=await c.text(),u=(new DOMParser).parseFromString(l,"text/html");if(a(u))return;const m=document.querySelector(t),g=u.querySelector(t);if(m&&g)return m.innerHTML=g.innerHTML,theme_content_loaded(),void setTimeout(()=>{o.focus()});location.href=h}catch(t){console.error(e.session_unkerror,{message:t.message,stack:t.stack}),location.href=h}})}else if(a());}(),function(){const s=document.querySelector(".session_login_flipper");if(null===s)return;const a=document.querySelector(n+" .form-signin-group > .btn-success"),c=s.querySelectorAll("[data-flipper]"),l=document.querySelector(n+' input[name="forgot"]'),u=document.querySelector(n+" [data-unlocker]"),d=document.querySelector(n+' input[name="newpass"]'),m=document.querySelector(n+' input[name="newpass2"]'),f=l&&l.dataset&&l.dataset.return,p=d&&d.dataset&&d.dataset.return,h=t,g=function(){const e=s,t=e.classList.contains("forgot");!t&&e.classList.toggle("flipping",!0),!t&&e.classList.toggle("forgot",!0),setTimeout(()=>{t&&e.classList.toggle("flipping",!1),t&&e.classList.toggle("forgot",!1)},600),e.classList.toggle("flipped");const n=e.classList.contains("flipped")?document.querySelector('input[name="forgot"]'):r;n&&setTimeout(()=>{e.classList.contains("flipped")||!n.value.trim()?n.focus():o&&o.focus()},600)},v=function(e){let t=e.querySelector(".panel-body > [data-fatal-error-text]");return t&&t.textContent.trim()||(t=e.querySelector(".panel-body > .err-content")),t};if(f&&setTimeout(()=>{g()},60),c&&c.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.dataset.webmin;if(t){const e=(location.origin+location.pathname.replace(/\/[^\/]*\.[^\/]*$/,"")).replace(/\/$/,""),n=encodeURIComponent(e);return void(location.href=`${t}?return=${n}`)}if(f||p)return e.stopImmediatePropagation(),void(location.href=f||p);g()})}),l&&l.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),a&&a.click(),!1}),d&&(d.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),m&&m.focus(),!1}),m&&m.addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),u&&u.click(),!1})),a&&a.addEventListener("click",function(t){if(t.preventDefault(),this.classList.contains("disabled"))return;if(!l||!l.value.trim())return void i("error",e.session_cannot);const n=l.value.trim(),r=this.querySelector("i");theme_spinner(r);let o=`forgot=${encodeURIComponent(n)}`;f&&(o+=`&return=${encodeURIComponent(f)}`),fetch("forgot_send.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:o}).then(t=>{if(t.url&&(serverRedirectUrl=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html"),o=n.querySelector(".panel-body > center");if(o&&o.textContent.trim())return theme_spinner(r,!0,!0),void i("success",o.innerHTML.trim());theme_spinner(r,!0);const s=v(n);if(s&&s.textContent.trim())return i("error",s.textContent.trim()),void l.focus();i("error",e.session_unkerror)}).catch(t=>{theme_spinner(r,!0),console.warn("Request failed:",t),i("error",e.session_conerror)})}),u){const t=document.querySelector(n),s=function(){t.remove(),function(){const e=new URL(window.location.href);e.search="",history.replaceState({},document.title,e)}();const e=document.querySelector(h+" .alert");e&&e.remove(),location.reload()};c.length>1&&c[1].addEventListener("click",function(e){e.preventDefault(),s()}),d&&setTimeout(()=>{d.focus()},0),u.addEventListener("click",function(n){if(n.preventDefault(),this.classList.contains("disabled"))return;if(!d||!d.value.length)return void i("error",e.session_resetepassreq);if(!m||!m.value.length)return void i("error",e.session_pwdconf);const s=d.value,a=m.value;if(s!==a)return void i("error",e.session_pwdmatch);const l=t?t.getAttribute("data-forgot"):null,u=t?t.getAttribute("data-username"):null;if(!l)return void i("error",e.session_noid);const f=this.querySelector("i");theme_spinner(f),fetch("forgot.cgi",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`id=${encodeURIComponent(l)}&newpass=${encodeURIComponent(s)}&newpass2=${encodeURIComponent(a)}`}).then(t=>{if(t.url&&(serverRedirectUrl=t.url),!t.ok)throw new Error(e.session_neterror);return t.text()}).then(n=>{const s=(new DOMParser).parseFromString(n,"text/html"),a=v(s);if(a&&a.textContent.trim())return theme_spinner(f,!0),void i("error",a.textContent.trim());if(p){const e=encodeURIComponent(t.getAttribute("data-username"));return void(location.href=`${p}?returned-username=${e}`)}theme_spinner(f,!0,!0),c[0].click(),i("success",e.session_pwdsucc,"unlock");const l=new URL(window.location.href);l.search="",history.replaceState({},document.title,l),u&&(r.value=u,o&&o.focus())}).catch(t=>{theme_spinner(f,!0),console.warn("Request failed:",t),i("error",e.session_conerror)})})}}(),function(){const e=document.querySelectorAll(t+" > .alert");e&&e.forEach(e=>{setTimeout(()=>{e.classList.remove("animated")},1500)})}(),o&&o.hasAttribute("autofocus")&&setTimeout(()=>{o.focus()},0),r&&r.hasAttribute("autofocus")&&setTimeout(()=>{r.focus()},0)}document.addEventListener("DOMContentLoaded",theme_content_loaded);